<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw HQ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:#0a0a0f;overflow:hidden}
canvas{display:block;width:100vw;height:100vh;image-rendering:pixelated;image-rendering:crisp-edges}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const C=document.getElementById('c'), X=C.getContext('2d');
const SCALE=2;
const IW=384*SCALE, IH=256*SCALE;
C.width=IW; C.height=IH;
X.imageSmoothingEnabled=false;
X.setTransform(SCALE,0,0,SCALE,0,0);

const TILE=16;
const LW=IW/SCALE, LH=IH/SCALE;
const COLS=Math.ceil(LW/TILE), ROWS=Math.ceil(LH/TILE);

const COL_FLOOR_A='#1a1a22';
const COL_FLOOR_B='#16161e';
const COL_DESK='#2a2530';
const COL_MONITOR_OFF='#111118';
const COL_TABLE='#3a2a1a';
const COL_CHAIR='#2a2225';
const COL_PLANT_POT='#4a3020';
const COL_PLANT='#1a4a2a';

const CREW=[
  {id:'clyde',name:'Clyde',emoji:'ðŸ™',color:'#2dd4a0',darkColor:'#1a8a66',feature:'tentacles'},
  {id:'sonnet',name:'Sonnet',emoji:'ðŸŽµ',color:'#f08050',darkColor:'#a05030',feature:'note'},
  {id:'flash',name:'GLM Flash',emoji:'âš¡',color:'#40b0e0',darkColor:'#2070a0',feature:'bolt'},
  {id:'qwen',name:'Qwen Coder',emoji:'ðŸ”§',color:'#9060d0',darkColor:'#5a3890',feature:'wrench'},
];

const DESKS=[
  {cx:5, cy:2, crewIdx:0},
  {cx:13,cy:2, crewIdx:1},
  {cx:5, cy:6, crewIdx:2},
  {cx:13,cy:6, crewIdx:3},
];

const TABLE_CX=9, TABLE_CY=12;
const TABLE_SEATS=[
  {dx:-2,dy:-1},{dx:2,dy:-1},{dx:-2,dy:1},{dx:2,dy:1}
];

const PLANTS=[{tx:1,ty:1},{tx:22,ty:1},{tx:1,ty:14},{tx:22,ty:14}];
const COOLER={tx:21,ty:4};
const WHITEBOARD={tx:8,ty:0,w:4,h:1};

const SYSTEM_STATE={
  clyde:{status:'active',station:'command',task:'Orchestrating crew'},
  sonnet:{status:'idle',station:'search',task:'Resting'},
  flash:{status:'scheduled',station:'comms',task:'Waiting for heartbeat'},
  qwen:{status:'idle',station:'code',task:'Resting'},
};

let liveMode=false;
const crewIdMap={clyde:'clyde',sonnet:'sonnet',glmFlash:'flash',qwenCoder:'qwen'};

const chars=CREW.map((cr,i)=>{
  const desk=DESKS[i];
  const state=SYSTEM_STATE[cr.id];
  const isActive=state.status==='active';
  const seat=TABLE_SEATS[i];
  return{
    ...cr, idx:i,
    px: isActive ? desk.cx*TILE+TILE/2 : (TABLE_CX+seat.dx)*TILE+TILE/2,
    py: isActive ? (desk.cy+2)*TILE : (TABLE_CY+seat.dy)*TILE+TILE/2,
    tx: isActive ? desk.cx*TILE+TILE/2 : (TABLE_CX+seat.dx)*TILE+TILE/2,
    ty: isActive ? (desk.cy+2)*TILE : (TABLE_CY+seat.dy)*TILE+TILE/2,
    state: state.status,
    task: state.task,
    atDesk: isActive,
    bobFrame:0,
    moveCooldown: 100+Math.random()*200|0,
  };
});

let frame=0;

function drawFloor(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      X.fillStyle=(r+c)%2===0?COL_FLOOR_A:COL_FLOOR_B;
      X.fillRect(c*TILE,r*TILE,TILE,TILE);
    }
  }
}

function drawDesk(desk){
  const x=desk.cx*TILE-TILE, y=desk.cy*TILE;
  const w=TILE*3, h=TILE;
  const cr=chars[desk.crewIdx];
  const isActive=cr.state==='active'&&cr.atDesk;

  // Desk surface
  X.fillStyle=COL_DESK;
  X.fillRect(x,y,w,h);
  X.fillStyle='#1e1a24';
  X.fillRect(x,y+h-1,w,1);

  // Monitor
  const mw=10, mh=8;
  const mx=x+w/2-mw/2|0, my=y-mh+2;
  X.fillStyle=COL_MONITOR_OFF;
  X.fillRect(mx,my,mw,mh);
  X.fillStyle=isActive?'#2266aa':'#141420';
  X.fillRect(mx+1,my+1,mw-2,mh-3);
  if(isActive){
    for(let ly=0;ly<mh-3;ly+=2){
      X.fillStyle='rgba(100,180,255,0.15)';
      X.fillRect(mx+1,my+1+ly,mw-2,1);
    }
    // Monitor glow
    X.fillStyle='rgba(60,120,200,0.06)';
    X.fillRect(mx-2,my-2,mw+4,mh+4);
  }
  // Stand
  X.fillStyle='#222';
  X.fillRect(mx+mw/2-1|0,my+mh-1,2,2);

  // Chair
  X.fillStyle=COL_CHAIR;
  const chairX=desk.cx*TILE+TILE/2-3|0, chairY=(desk.cy+1)*TILE+4;
  X.fillRect(chairX,chairY,6,6);
  X.fillStyle='#222028';
  X.fillRect(chairX+1,chairY+1,4,4);

  // Desk label
  X.fillStyle=cr.color+'66';
  X.font='4px monospace';
  X.textAlign='center';
  X.fillText(cr.name,x+w/2,y+h+4);
}

function drawMeetingTable(){
  const cx=TABLE_CX*TILE+TILE/2, cy=TABLE_CY*TILE+TILE/2;
  const tw=TILE*3, th=TILE*2;
  X.fillStyle=COL_TABLE;
  X.fillRect(cx-tw/2|0,cy-th/2|0,tw,th);
  X.fillStyle='#302018';
  X.fillRect((cx-tw/2|0)+1,(cy-th/2|0)+1,tw-2,th-2);
  // Highlight
  X.fillStyle='#443020';
  X.fillRect((cx-tw/2|0)+2,(cy-th/2|0)+1,tw-4,1);

  TABLE_SEATS.forEach(s=>{
    const sx=(TABLE_CX+s.dx)*TILE+TILE/2-3|0;
    const sy=(TABLE_CY+s.dy)*TILE+TILE/2-3|0;
    X.fillStyle=COL_CHAIR;
    X.fillRect(sx,sy,6,6);
    X.fillStyle='#1a1820';
    X.fillRect(sx+1,sy+1,4,4);
  });
}

function drawPlants(){
  PLANTS.forEach(p=>{
    const x=p.tx*TILE+TILE/2, y=p.ty*TILE+TILE;
    X.fillStyle=COL_PLANT_POT;
    X.fillRect(x-3,y-4,6,4);
    X.fillRect(x-2,y-6,4,2);
    X.fillStyle=COL_PLANT;
    X.fillRect(x-4,y-10,3,4);
    X.fillRect(x+1,y-10,3,4);
    X.fillRect(x-2,y-12,4,3);
    X.fillStyle='#266a3a';
    X.fillRect(x-1,y-11,2,2);
  });
}

function drawCooler(){
  const x=COOLER.tx*TILE+TILE/2, y=COOLER.ty*TILE;
  X.fillStyle='#667788';
  X.fillRect(x-3,y,6,10);
  X.fillStyle='#8899aa';
  X.fillRect(x-3,y,6,2);
  X.fillStyle='#5588cc';
  X.fillRect(x-2,y+2,4,5);
  X.fillStyle='#aaa';
  X.fillRect(x-1,y+7,2,1);
}

function drawWhiteboard(){
  const x=WHITEBOARD.tx*TILE, y=WHITEBOARD.ty*TILE+1;
  const w=WHITEBOARD.w*TILE, h=WHITEBOARD.h*TILE;
  X.fillStyle='#333';
  X.fillRect(x-1,y-1,w+2,h+2);
  X.fillStyle='#ddddd8';
  X.fillRect(x,y,w,h);
  X.fillStyle='#cc4444';
  X.fillRect(x+3,y+3,12,1);
  X.fillStyle='#4444cc';
  X.fillRect(x+3,y+6,18,1);
  X.fillStyle='#44aa44';
  X.fillRect(x+3,y+9,14,1);
  X.fillStyle='#555';
  X.fillRect(x+2,y+h,w-4,1);
}

function drawPixelChar(ch){
  const x=ch.px|0, y=ch.py|0;
  const isMoving=ch.px!==ch.tx||ch.py!==ch.ty;
  const bob=(frame%30<15&&(ch.state==='active'||isMoving))?-1:0;
  const isActive=ch.state==='active';
  const py=y+bob;

  // Shadow
  X.fillStyle='rgba(0,0,0,0.25)';
  X.fillRect(x-3,py+4,6,2);

  // Body (6x8)
  X.fillStyle=ch.color;
  X.fillRect(x-3,py-4,6,8);
  X.fillStyle=ch.darkColor;
  X.fillRect(x-3,py-4,1,8);
  X.fillRect(x+2,py-4,1,8);

  // Head (6x5)
  X.fillStyle=ch.color;
  X.fillRect(x-3,py-9,6,5);
  // Highlight
  X.fillStyle=ch.color+'dd';
  X.fillRect(x-2,py-9,4,1);

  // Eyes
  X.fillStyle='#ffffff';
  X.fillRect(x-2,py-7,2,2);
  X.fillRect(x+1,py-7,2,2);
  X.fillStyle='#111';
  X.fillRect(x-1,py-6,1,1);
  X.fillRect(x+2,py-6,1,1);

  // Features
  if(ch.feature==='tentacles'){
    X.fillStyle=ch.darkColor;
    X.fillRect(x-4,py+4,2,2);
    X.fillRect(x-1,py+5,2,1);
    X.fillRect(x+3,py+4,2,2);
  } else if(ch.feature==='note'){
    X.fillStyle='#ffe0a0';
    X.fillRect(x+4,py-11,1,4);
    X.fillRect(x+3,py-8,2,1);
    X.fillRect(x+5,py-11,1,1);
  } else if(ch.feature==='bolt'){
    X.fillStyle='#ffdd44';
    X.fillRect(x+4,py-8,2,1);
    X.fillRect(x+3,py-7,2,1);
    X.fillRect(x+4,py-6,2,1);
    X.fillRect(x+5,py-5,2,1);
  } else if(ch.feature==='wrench'){
    X.fillStyle='#bbb';
    X.fillRect(x+4,py-7,1,4);
    X.fillRect(x+3,py-8,3,1);
    X.fillRect(x+3,py-3,3,1);
  }

  // Status dot
  X.fillStyle=isActive?'#44dd66':ch.state==='scheduled'?'#ddaa22':'#555555';
  X.fillRect(x-5,py-9,2,2);

  // Name
  X.fillStyle=ch.color;
  X.font='5px monospace';
  X.textAlign='center';
  X.fillText(ch.name,x,py+12);
}

function updateChars(){
  chars.forEach(ch=>{
    ch.bobFrame++;

    // Grid-snapped movement
    if(ch.px!==ch.tx||ch.py!==ch.ty){
      const dx=ch.tx-ch.px, dy=ch.ty-ch.py;
      if(Math.abs(dx)>=Math.abs(dy)){
        ch.px+=dx>0?1:-1;
      } else {
        ch.py+=dy>0?1:-1;
      }
      if(Math.abs(ch.px-ch.tx)<=1&&Math.abs(ch.py-ch.ty)<=1){
        ch.px=ch.tx; ch.py=ch.ty;
      }
    }

    if(!liveMode){
      ch.moveCooldown--;
      if(ch.moveCooldown<=0){
        ch.moveCooldown=120+Math.random()*240|0;
        if(ch.state==='active'){
          const desk=DESKS[ch.idx];
          ch.tx=desk.cx*TILE+TILE/2+(Math.random()*6-3|0);
          ch.ty=(desk.cy+2)*TILE+(Math.random()*4-2|0);
          ch.atDesk=true;
        } else {
          if(Math.random()<0.5){
            const seat=TABLE_SEATS[ch.idx];
            ch.tx=(TABLE_CX+seat.dx)*TILE+TILE/2;
            ch.ty=(TABLE_CY+seat.dy)*TILE+TILE/2;
          } else {
            ch.tx=(TABLE_CX+(Math.random()*6-3|0))*TILE;
            ch.ty=(TABLE_CY+(Math.random()*4-2|0))*TILE;
          }
          ch.atDesk=false;
        }
        ch.tx=Math.max(TILE,Math.min(LW-TILE*2,ch.tx))|0;
        ch.ty=Math.max(TILE*2,Math.min(LH-TILE*3,ch.ty))|0;
      }
    }
  });
}

function drawStatusBar(){
  X.fillStyle='#0c0c12';
  X.fillRect(0,LH-14,LW,14);
  X.fillStyle='#1a1a24';
  X.fillRect(0,LH-14,LW,1);

  chars.forEach((ch,i)=>{
    const bx=i*(IW/4), by=IH-12;
    X.fillStyle=ch.state==='active'?'#44dd66':ch.state==='scheduled'?'#ddaa22':'#555';
    X.fillRect(bx+2,by+2,3,3);
    X.fillStyle=ch.color;
    X.font='5px monospace';
    X.textAlign='left';
    X.fillText(ch.name,bx+7,by+6);
    X.fillStyle='#555';
    const taskText=ch.task.length>14?ch.task.slice(0,13)+'â€¦':ch.task;
    X.fillText(taskText,bx+7,by+12);
  });

  const d=new Date();
  const t=d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  X.fillStyle=liveMode?'#44dd66':'#555';
  X.font='5px monospace';
  X.textAlign='right';
  X.fillText((liveMode?'â— LIVE':'â—‹ SIM')+' '+t,LW-2,LH-6);
}

function drawHeader(){
  X.fillStyle='#0c0c12';
  X.fillRect(0,0,LW,10);
  X.fillStyle='#1a1a24';
  X.fillRect(0,10,LW,1);
  X.fillStyle='#8866cc';
  X.font='bold 6px monospace';
  X.textAlign='center';
  X.fillText('OPENCLAW HQ',LW/2,7);
}

function draw(){
  frame++;
  X.clearRect(0,0,LW,LH);
  drawFloor();
  drawHeader();
  drawWhiteboard();
  DESKS.forEach(drawDesk);
  drawMeetingTable();
  drawPlants();
  drawCooler();
  chars.sort((a,b)=>a.py-b.py).forEach(drawPixelChar);
  drawStatusBar();
  updateChars();
  requestAnimationFrame(draw);
}
draw();

function applyLiveData(data){
  Object.entries(data.crew).forEach(([jsonId,info])=>{
    const charId=crewIdMap[jsonId];
    if(!charId) return;
    const ch=chars.find(c=>c.id===charId);
    if(!ch) return;
    ch.task=info.task;
    ch.state=info.status;
    if(info.status==='active'&&info.currentStation!=='rest'){
      const desk=DESKS[ch.idx];
      ch.tx=desk.cx*TILE+TILE/2;
      ch.ty=(desk.cy+2)*TILE;
      ch.atDesk=true;
      ch.moveCooldown=999999;
    } else {
      const seat=TABLE_SEATS[ch.idx];
      ch.tx=(TABLE_CX+seat.dx)*TILE+TILE/2;
      ch.ty=(TABLE_CY+seat.dy)*TILE+TILE/2;
      ch.atDesk=false;
      ch.moveCooldown=999999;
    }
  });
}

async function pollStatus(){
  try{
    const resp=await fetch('crew-status.json?t='+Date.now());
    if(!resp.ok) throw new Error('not found');
    const data=await resp.json();
    liveMode=true;
    applyLiveData(data);
  } catch(e){
    liveMode=false;
    chars.forEach(ch=>{if(ch.moveCooldown>99999)ch.moveCooldown=100+Math.random()*200|0;});
  }
}
pollStatus();
setInterval(pollStatus,60000);
</script>
</body>
</html>
